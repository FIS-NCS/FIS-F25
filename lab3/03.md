# Malware Detection

After discovering a new malware sample, researchers usually extract its **signatures** to be used by anti-viruses and [Intrusion Detection Systems (IDS)](https://en.wikipedia.org/wiki/Intrusion_detection_system) to automatically detect further infections of the same malware.

- Malware signature is the most common form of IoCs ([Indicators of Compromise](https://threatfox.abuse.ch/browse/))

## Practice

[YARA](https://github.com/VirusTotal/yara) is an open-source pattern-matching engine for files (including binaries). It helps identify and classify malware samples using a description (rule) syntax.

1. Install YARA

   ```bash
   sudo apt install yara
   ```

1. Write a detection rule for EICAR: `rule.yar`

   > Large collections of rules for known malware are available online (e.g., [Valhalla API](https://valhalla.nextron-systems.com/) or [GitHub](https://github.com/InQuest/awesome-yara))

   ```ini
   rule EICAR_Detection {
       meta:
           description = "Comprehensive EICAR test file detection"
           author = "Security Analyst"
           date = "2025"
           reference = "https://www.eicar.org/download-anti-malware-testfile/"
           
       strings:
           // Full EICAR string
           $eicar_full = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
           
           // Common variations and partial matches
           $eicar_partial1 = "EICAR-STANDARD-ANTIVIRUS-TEST-FILE"
           $eicar_partial2 = "X5O!P%@AP"
           $eicar_partial3 = "PZX54(P^)7CC)7}"
           
       condition:
           any of them
   }
   ```

1. Test the rule against the file

   ```bash
   wget https://secure.eicar.org/eicar.com.txt
   yara rule.yar eicar.com.txt
   ```

## Exercise 2

Can you write a `.yar` rule to match the suspicious file from exercise 1?

- A good rule should be as generic as possible; i.e., able to match variations of the same malware effectively.
- Write and test the rule, verify it works against the downloaded file.
