# Password Attacks

**Online attacks** against a live service (e.g., HTTP, FTP, SSH, ...) presents multiple issues:

- Risk of detection/blocking
- Rate limiting by servers
- Slow feedback due to network delay
- Impossible to automate if CAPTCHAs are enforced

**Offline attacks** are much more approachable (like bringing a sealed safe home). Examples include:

- Capturing a wireless handshake for later decryption
- Cracking an encrypted file (ZIP Archive, KeePass DB, Encrypted PDF file, ...)
- Uncovering a user's password given `passwd` and `shadow` files.

The goal is generally to extract the hashes from such artifacts into a format that your cracker (e.g., `john` or `hashcat`) understands, then use different techniques (mostly utilizing a wordlist) to attack the hashes. GPU power is often utilized to speed up the process.

## Practice

1. Install john the ripper. **The debian (`apt`) package is outdated and missing most features**. Your options are:

    - To build `john` from source

        ```bash
        wget https://github.com/openwall/john/archive/refs/heads/bleeding-jumbo.zip
        unzip bleeding-jumbo.zip
        cd john-bleeding-jumbo/src/
        ./configure
        make -s clean && make -sj4
        cd ..
        ```

    - To use [community packages](https://github.com/openwall/john-packages). For Linux, there are packages for snap, flatpak, and a docker image. Docker image can be launched with a simple command:

        ```bash
        docker run --rm ghcr.io/openwall/john" --help
        ```

2. Download `rockyou.txt`: a very popular password wordlist

    ```bash
    wget https://gitlab.com/kalilinux/packages/wordlists/-/raw/kali/master/rockyou.txt.gz
    gunzip rockyou.txt.gz
    ```

3. Let's crack a SHA-1 hash using the wordlist.

    ```bash
    echo "b0f98804c509999fc028a2267597baac38464af7" > hash.txt
    ```

    ```bash
    ./run/john --format=raw-sha1 --wordlist=rockyou.txt hash.txt
    ```

## Exercise 5

Additional tools from the `john` suite can help extract hashes from other formats (e.g., zip archive, passwd+shadow files, authentication pcap) into a format that `john` understands. Practice with two scenarios:

1. You managed to obtain a zip archive with secret data, but it's password-protected. Extract the hashes and crack the file.

    ```bash
    wget http://renderer:10082/workshop/content/archive.zip
    ```

2. A path traveral exploit for a web app allowed you to see the content of `/etc/passwd` and `/etc/shadow` for a target system [[recall the format]](https://en.wikipedia.org/wiki/Passwd#Password_file). Combine the entries and crack the password.

    - Passwd entry: `dev:x:1001:1001::/home/dev:/usr/bin/fish`
    - Shadow entry `dev:$y$j9T$g3GP/xAvGNuETEqlI.ifO/$0bqofShzjiLT1v0dMyvlirrJa2II9X3fTEQVnqCmi3/:20326:0:99999:7:::`

> Recall: [UNIX Password Scheme](https://d2vlcm61l7u1fs.cloudfront.net/media%2F608%2F6087c87d-da9d-4d24-bffc-5802f54192d8%2Fphp3KhbvO.png)
